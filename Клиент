import os
import json
from datetime import datetime
from typing import Dict, List, Optional
from dataclasses import dataclass, field

import streamlit as st

# =========================
# –ö–û–ù–°–¢–ê–ù–¢–´
# =========================

POTENTIALS = [
    "–ê–º–µ—Ç–∏—Å—Ç",
    "–ì—Ä–∞–Ω–∞—Ç",
    "–¶–∏—Ç—Ä–∏–Ω",
    "–°–∞–ø—Ñ–∏—Ä",
    "–ì–µ–ª–∏–æ–¥–æ—Ä",
    "–ò–∑—É–º—Ä—É–¥",
    "–Ø–Ω—Ç–∞—Ä—å",
    "–†—É–±–∏–Ω",
    "–®—É–Ω–≥–∏—Ç",
]

COLUMNS = ["c1", "c2", "c3"]  # 1 —Å—Ç–æ–ª–±–µ—Ü, 2, 3

RESULTS_FILE = "deep_identity_results.json"


# =========================
# –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# =========================

def load_results() -> List[Dict]:
    if not os.path.exists(RESULTS_FILE):
        return []
    try:
        with open(RESULTS_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    except Exception:
        return []


def save_results(results: List[Dict]) -> None:
    with open(RESULTS_FILE, "w", encoding="utf-8") as f:
        json.dump(results, f, ensure_ascii=False, indent=2)


# =========================
# –û–±—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session_state
# =========================

def init_session_state():
    if "initialized_global" in st.session_state:
        return

    st.session_state.initialized_global = True

    # —Ç–µ–∫—É—â–∏–π –±–ª–æ–∫
    st.session_state.current_block = 1

    # —Ç–∞–±–ª–∏—Ü—ã –∏ —Ç–µ–∫—Å—Ç—ã –ø–æ –±–ª–æ–∫–∞–º
    for block in (1, 2, 3):
        cols_key = f"block{block}_cols"
        text_key = f"block{block}_text"
        if cols_key not in st.session_state:
            st.session_state[cols_key] = {p: {c: 0 for c in COLUMNS} for p in POTENTIALS}
        if text_key not in st.session_state:
            st.session_state[text_key] = ""

    st.session_state.setdefault("user_name", "")
    st.session_state.setdefault("user_contact", "")


# =====================================================
# –ë–õ–û–ö 1. –î–ï–¢–°–¢–í–û ‚Äî –í–û–ü–†–û–°–ù–ò–ö –° –í–ï–¢–í–õ–ï–ù–ò–Ø–ú–ò
# =====================================================

@dataclass
class AnswerOption:
    text: str
    score_changes: Dict[str, int] = field(default_factory=dict)
    inject_questions: List[str] = field(default_factory=list)


@dataclass
class Question:
    id: str
    text: str
    options: List[AnswerOption]


def build_block1_questions() -> Dict[str, Question]:
    """–ü—É–ª –≤–æ–ø—Ä–æ—Å–æ–≤ –ë–ª–æ–∫–∞ 1. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—ã —É–∂–µ –≤ —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏—è—Ö."""
    q: Dict[str, Question] = {}

    # Q1 ‚Äì —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è
    q["b1_q1_free_time"] = Question(
        id="b1_q1_free_time",
        text="–ö–∞–∫ —Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–≤–æ–¥–∏–ª(–∞) —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –≤ –¥–µ—Ç—Å—Ç–≤–µ (–ª–µ—Ç –¥–æ 10)?",
        options=[
            AnswerOption(
                text="–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã: –±–µ–≥, –¥–æ–≥–æ–Ω—è–ª–∫–∏, –ª–∞–∑–∞–Ω–∏–µ, –¥—Ä–∞–∫–∏, —Å–ø–æ—Ä—Ç",
                score_changes={"–®—É–Ω–≥–∏—Ç": 2},
                inject_questions=["b1_q_sport_detail"],
            ),
            AnswerOption(
                text="–° –∫–Ω–∏–≥–∞–º–∏, –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞–º–∏, –Ω–∞–±–ª—é–¥–∞–ª(–∞), –º–Ω–æ–≥–æ –¥—É–º–∞–ª(–∞)",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 2, "–°–∞–ø—Ñ–∏—Ä": 1},
                inject_questions=["b1_q_reading_detail"],
            ),
            AnswerOption(
                text="–ò–≥—Ä–∞–ª(–∞) –≤ ¬´–º–∞–≥–∞–∑–∏–Ω¬ª, –ø—Ä–æ–¥–∞–∂–∏, –æ–±–º–µ–Ω—ã, –º–∏–Ω–∏-–±–∏–∑–Ω–µ—Å—ã",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 2},
                inject_questions=["b1_q_trading_detail"],
            ),
            AnswerOption(
                text="–°—Ç–∞–≤–∏–ª(–∞) –∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Å—Ü–µ–Ω–∫–∏, –ª—é–±–∏–ª(–∞) –≤—ã—Å—Ç—É–ø–∞—Ç—å",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 2, "–†—É–±–∏–Ω": 1},
                inject_questions=["b1_q_stage_detail"],
            ),
            AnswerOption(
                text="–í–æ–∑–∏–ª—Å—è(–∞—Å—å) —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏, –æ—á–µ–Ω—å –∂–∞–ª–∫–æ –∏—Ö, –ª–µ—á–∏–ª(–∞), –∫–æ—Ä–º–∏–ª(–∞)",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2},
                inject_questions=["b1_q_animals_detail"],
            ),
            AnswerOption(
                text="–õ—é–±–∏–ª(–∞) —Ä–∞–∑–±–∏—Ä–∞—Ç—å/—Å–æ–±–∏—Ä–∞—Ç—å, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –õ–µ–≥–æ, –º–æ–∑–∞–∏–∫–∏",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1, "–ê–º–µ—Ç–∏—Å—Ç": 1},
                inject_questions=["b1_q_order_tech_detail"],
            ),
            AnswerOption(
                text="–ë–æ–ª—å—à–µ –æ–±—â–∞–ª—Å—è(–∞—Å—å), —à—É—Ç–∏–ª(–∞), –ø—Ä–∏–¥—É–º—ã–≤–∞–ª(–∞) –∏—Å—Ç–æ—Ä–∏–∏",
                score_changes={"–ì–µ–ª–∏–æ–¥–æ—Ä": 2},
                inject_questions=["b1_q_talk_detail"],
            ),
        ],
    )

    # Q2 ‚Äì –ª—é–±–∏–º—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
    q["b1_q2_subjects"] = Question(
        id="b1_q2_subjects",
        text="–ö–∞–∫–∏–µ —à–∫–æ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Ç—ã –ª—é–±–∏–ª(–∞) –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        options=[
            AnswerOption(
                text="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞, —Ñ–∏–∑–∏–∫–∞, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞, –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 2, "–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –∏—Å—Ç–æ—Ä–∏—è, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è, –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ",
                score_changes={"–°–∞–ø—Ñ–∏—Ä": 2, "–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
            AnswerOption(
                text="–ú—É–∑—ã–∫–∞, –ø–µ–Ω–∏–µ, —Ç–µ–∞—Ç—Ä, —Å—Ü–µ–Ω–∞",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 2, "–ì–µ–ª–∏–æ–¥–æ—Ä": 1},
                inject_questions=["b1_q_music_detail"],
            ),
            AnswerOption(
                text="–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞, –ª—é–±—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è",
                score_changes={"–®—É–Ω–≥–∏—Ç": 2},
                inject_questions=["b1_q_sport_detail"],
            ),
            AnswerOption(
                text="–†–∏—Å–æ–≤–∞–Ω–∏–µ, –¥–∏–∑–∞–π–Ω, –≤—Å—ë –∫—Ä–∞—Å–∏–≤–æ–µ –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2},
            ),
            AnswerOption(
                text="–ß–µ—Å—Ç–Ω–æ ‚Äî –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–æ –Ω–µ –ª—é–±–∏–ª(–∞), —É—á–∏–ª—Å—è(–∞—Å—å) ¬´–∫–∞–∫ –Ω–∞–¥–æ¬ª",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
        ],
    )

    # Q3 ‚Äì –∫—Ä—É–∂–∫–∏
    q["b1_q3_clubs"] = Question(
        id="b1_q3_clubs",
        text="–ù–∞ –∫–∞–∫–∏–µ –∫—Ä—É–∂–∫–∏/—Å–µ–∫—Ü–∏–∏ —Ç—ã —Ö–æ–¥–∏–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ?",
        options=[
            AnswerOption(
                text="–°–ø–æ—Ä—Ç (–±–æ–∏, —Ñ—É—Ç–±–æ–ª, —Ç–∞–Ω—Ü—ã, –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ –∏ —Ç.–ø.)",
                score_changes={"–®—É–Ω–≥–∏—Ç": 2},
                inject_questions=["b1_q_sport_detail"],
            ),
            AnswerOption(
                text="–ú—É–∑—ã–∫–∞/–≤–æ–∫–∞–ª/—Ç–µ–∞—Ç—Ä/—Ç–∞–Ω—Ü—ã –∏–º–µ–Ω–Ω–æ –∫–∞–∫ —Å—Ü–µ–Ω–∞ –∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 2, "–ì–µ–ª–∏–æ–¥–æ—Ä": 1},
                inject_questions=["b1_q_stage_detail"],
            ),
            AnswerOption(
                text="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫—Ä—É–∂–∫–∏, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 2, "–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
            AnswerOption(
                text="–†–∏—Å–æ–≤–∞–Ω–∏–µ, –¥–∏–∑–∞–π–Ω, hand-made",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2},
            ),
            AnswerOption(
                text="–ë–∏–∑–Ω–µ—Å/–ª–∏–¥–µ—Ä—Å—Ç–≤–æ/—ç–∫–æ–Ω–æ–º–∏–∫–∞/–æ–ª–∏–º–ø–∏–∞–¥—ã",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 2, "–†—É–±–∏–Ω": 1},
            ),
            AnswerOption(
                text="–ü–æ—á—Ç–∏ –Ω–∏–∫—É–¥–∞ –Ω–µ —Ö–æ–¥–∏–ª(–∞) / –≤—Å—ë –±—ã–ª–æ ¬´–ø–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏¬ª",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
        ],
    )

    # Q4 ‚Äì –∫—Ç–æ –≤—ã–±–∏—Ä–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    q["b1_q4_choice"] = Question(
        id="b1_q4_choice",
        text="–ö—Ç–æ —á–∞—â–µ –≤—ã–±–∏—Ä–∞–ª, —á–µ–º —Ç—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è (–∫—Ä—É–∂–∫–∏, —Å–µ–∫—Ü–∏–∏, –∑–∞–Ω—è—Ç–∏—è)?",
        options=[
            AnswerOption(
                text="–í –æ—Å–Ω–æ–≤–Ω–æ–º —è —Å–∞–º(–∞) —Ä–µ—à–∞–ª(–∞), —á—Ç–æ —Ö–æ—á—É –¥–µ–ª–∞—Ç—å",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 1, "–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
            AnswerOption(
                text="–ß–∞—â–µ —Ä–æ–¥–∏—Ç–µ–ª–∏/–≤–∑—Ä–æ—Å–ª—ã–µ, –∞ —è –ø—Ä–æ—Å—Ç–æ —Å–æ–≥–ª–∞—à–∞–ª—Å—è(–∞—Å—å)",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–ö–æ–º–±–æ: —è –ø—Ä–æ—è–≤–ª—è–ª(–∞) –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É, –Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ –∑–∞ –≤–∑—Ä–æ—Å–ª—ã–º–∏",
                score_changes={"–†—É–±–∏–Ω": 1},
            ),
        ],
    )

    # Q5 ‚Äì —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
    q["b1_q5_speaking"] = Question(
        id="b1_q5_speaking",
        text="–ö–∞–∫–æ–π —Ç—ã –±—ã–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ –ø–æ –æ–±—â–µ–Ω–∏—é?",
        options=[
            AnswerOption(
                text="–ú–Ω–æ–≥–æ –≥–æ–≤–æ—Ä–∏–ª(–∞), —à—É—Ç–∏–ª(–∞), –ª—é–±–∏–ª(–∞) –∫–æ–º–ø–∞–Ω–∏—é",
                score_changes={"–ì–µ–ª–∏–æ–¥–æ—Ä": 2, "–ì—Ä–∞–Ω–∞—Ç": 1},
                inject_questions=["b1_q_talk_detail"],
            ),
            AnswerOption(
                text="–°–∫–æ—Ä–µ–µ —Ç–∏—Ö–∏–π(–∞—è), –Ω–∞–±–ª—é–¥–∞–ª(–∞), –±–æ–ª—å—à–µ —Å–ª—É—à–∞–ª(–∞)",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 1, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
            AnswerOption(
                text="–°–≤–æ–∏–º ‚Äî –¥—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏, —Å —á—É–∂–∏–º–∏ ‚Äî –∑–∞–∫—Ä—ã—Ç—ã–π(–∞—è)",
                score_changes={"–ì–µ–ª–∏–æ–¥–æ—Ä": 1, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
        ],
    )

    # Q6 ‚Äì –∂–∏–≤–æ—Ç–Ω—ã–µ
    q["b1_q6_animals"] = Question(
        id="b1_q6_animals",
        text="–ë—ã–ª–∏ –ª–∏ —É —Ç–µ–±—è –≤ –¥–µ—Ç—Å—Ç–≤–µ –¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ?",
        options=[
            AnswerOption(
                text="–î–∞, –æ—á–µ–Ω—å –ø—Ä–∏–≤—è–∑—ã–≤–∞–ª—Å—è(–∞—Å—å), —É—Ö–∞–∂–∏–≤–∞–ª(–∞), –ø–µ—Ä–µ–∂–∏–≤–∞–ª(–∞) –∑–∞ –Ω–∏—Ö",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2},
                inject_questions=["b1_q_animals_detail"],
            ),
            AnswerOption(
                text="–î–∞, –Ω–æ –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) —Å–ø–æ–∫–æ–π–Ω–æ, –±–µ–∑ —Å–∏–ª—å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 1},
            ),
            AnswerOption(
                text="–ü–æ—á—Ç–∏ –Ω–µ –±—ã–ª–æ / –º–Ω–µ –±—ã–ª–æ –Ω–µ –æ—Å–æ–±–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ",
                score_changes={},
            ),
        ],
    )

    # Q7 ‚Äì —Ç–µ–ª–æ/—Å–ø–æ—Ä—Ç
    q["b1_q7_body"] = Question(
        id="b1_q7_body",
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º –∏ —Å–ø–æ—Ä—Ç—É?",
        options=[
            AnswerOption(
                text="–û–±–æ–∂–∞–ª(–∞) –¥–≤–∏–≥–∞—Ç—å—Å—è, —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ–ª–æ, —É—Å—Ç–∞–ª–æ—Å—Ç—å, —Å–∏–ª—É",
                score_changes={"–®—É–Ω–≥–∏—Ç": 2},
                inject_questions=["b1_q_sport_detail"],
            ),
            AnswerOption(
                text="–°–ø–æ—Ä—Ç –±—ã–ª, –Ω–æ –±–æ–ª—å—à–µ –∫–∞–∫ ¬´–Ω–∞–¥–æ¬ª, –±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–°–∫–æ—Ä–µ–µ –∏–∑–±–µ–≥–∞–ª(–∞), –ª—é–±–∏–ª(–∞) —Å–ø–æ–∫–æ–π–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 1, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
        ],
    )

    # Q8 ‚Äì –ø–æ—Ä—è–¥–æ–∫
    q["b1_q8_order"] = Question(
        id="b1_q8_order",
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ –ø–æ—Ä—è–¥–∫—É –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
        options=[
            AnswerOption(
                text="–õ—é–±–∏–ª(–∞) –ø–æ—Ä—è–¥–æ–∫, –≤—Å—ë –ø–æ –º–µ—Å—Ç–∞–º, —Ö–∞–æ—Å —Ä–∞–∑–¥—Ä–∞–∂–∞–ª",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 2},
                inject_questions=["b1_q_order_tech_detail"],
            ),
            AnswerOption(
                text="–ù–æ—Ä–º–∞–ª—å–Ω–æ, –º–æ–≥(–ª–∞) –Ω–∞–≤–æ–¥–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫, –Ω–æ –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–ª—Å—è(–∞—Å—å)",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–ú–æ–≥(–ª–∞) –∂–∏—Ç—å –≤ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–º –±–µ—Å–ø–æ—Ä—è–¥–∫–µ, –≥–ª–∞–≤–Ω–æ–µ ‚Äî –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 1, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
        ],
    )

    # Q9 ‚Äì —á—Ç–µ–Ω–∏–µ
    q["b1_q9_reading"] = Question(
        id="b1_q9_reading",
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ —á—Ç–µ–Ω–∏—é –∏ –æ–±—É—á–µ–Ω–∏—é?",
        options=[
            AnswerOption(
                text="–ú–Ω–æ–≥–æ —á–∏—Ç–∞–ª(–∞) —Å–∞–º(–∞), –Ω—Ä–∞–≤–∏–ª–æ—Å—å —É–∑–Ω–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 2, "–°–∞–ø—Ñ–∏—Ä": 1},
                inject_questions=["b1_q_reading_detail"],
            ),
            AnswerOption(
                text="–ß–∏—Ç–∞–ª(–∞), –µ—Å–ª–∏ –Ω–∞–¥–æ –¥–ª—è —à–∫–æ–ª—ã, —Å–∞–º(–∞) —Ä–µ–¥–∫–æ –≤—ã–±–∏—Ä–∞–ª(–∞) –∫–Ω–∏–≥–∏",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–ß—Ç–µ–Ω–∏–µ –ø–æ—á—Ç–∏ –Ω–µ –ø—Ä–∏–≤–ª–µ–∫–∞–ª–æ",
                score_changes={},
            ),
        ],
    )

    # Q10 ‚Äì –¥–µ–Ω—å–≥–∏/–∏–≥—Ä—ã
    q["b1_q10_money"] = Question(
        id="b1_q10_money",
        text="–ë—ã–ª–∏ –ª–∏ —É —Ç–µ–±—è –∏–≥—Ä—ã/–∑–∞–Ω—è—Ç–∏—è —Å –¥–µ–Ω—å–≥–∞–º–∏, –ø—Ä–æ–¥–∞–∂–∞–º–∏, –æ–±–º–µ–Ω–∞–º–∏?",
        options=[
            AnswerOption(
                text="–î–∞, –ª—é–±–∏–ª(–∞) –ø—Ä–æ–¥–∞–≤–∞—Ç—å, –º–µ–Ω—è—Ç—å, —Ç–æ—Ä–≥–æ–≤–∞—Ç—å—Å—è",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 2},
                inject_questions=["b1_q_trading_detail"],
            ),
            AnswerOption(
                text="–ò–Ω–æ–≥–¥–∞, –Ω–æ –±–µ–∑ —Å–∏–ª—å–Ω–æ–π —Ç—è–≥–∏",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 1},
            ),
            AnswerOption(
                text="–ù–µ—Ç, –Ω–µ –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–æ",
                score_changes={},
            ),
        ],
    )

    # Q11 ‚Äì —Å—Ü–µ–Ω–∞/–∑–∞–∫—É–ª–∏—Å—å–µ
    q["b1_q11_scene"] = Question(
        id="b1_q11_scene",
        text="–ù–∞ —à–∫–æ–ª—å–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–∞—Ö –≥–¥–µ —Ç—ã —Å–µ–±—è –±–æ–ª—å—à–µ –≤–∏–¥–µ–ª(–∞)?",
        options=[
            AnswerOption(
                text="–ù–∞ —Å—Ü–µ–Ω–µ, –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 2},
            ),
            AnswerOption(
                text="–ó–∞ –∫–∞–¥—Ä–æ–º: –ø—Ä–∏–¥—É–º–∞—Ç—å, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –≤—Å—ë –±—ã–ª–æ –∏–¥–µ–∞–ª—å–Ω–æ",
                score_changes={"–†—É–±–∏–Ω": 2, "–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–í –∑–∞–ª–µ: –Ω–∞–±–ª—é–¥–∞—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 1, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
        ],
    )

    # Q12 ‚Äì —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    q["b1_q12_empathy"] = Question(
        id="b1_q12_empathy",
        text="–ù–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –±—ã–ª(–∞) —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º —Ä–µ–±—ë–Ω–∫–æ–º?",
        options=[
            AnswerOption(
                text="–û—á–µ–Ω—å: –º–æ–≥(–ª–∞) –∑–∞–ø–ª–∞–∫–∞—Ç—å –æ—Ç —Ñ–∏–ª—å–º–∞, –∂–∞–ª–∫–æ –ª—é–¥–µ–π –∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
            AnswerOption(
                text="–°—Ä–µ–¥–Ω–µ, –∏–Ω–æ–≥–¥–∞ —Ç—Ä–æ–≥–∞–ª–æ",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 1},
            ),
            AnswerOption(
                text="–†–µ–¥–∫–æ —á—Ç–æ-—Ç–æ —Ü–µ–ø–ª—è–ª–æ, –±–æ–ª—å—à–µ –≤ –≥–æ–ª–æ–≤–µ, —á–µ–º –≤ —á—É–≤—Å—Ç–≤–∞—Ö",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
        ],
    )

    # Q13 ‚Äì –º–µ—á—Ç—ã
    q["b1_q13_dreams"] = Question(
        id="b1_q13_dreams",
        text="–û —á—ë–º —Ç—ã –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–µ—á—Ç–∞–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ/–ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ?",
        options=[
            AnswerOption(
                text="–°—Ç–∞—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–º(–æ–π), –ø–æ–ø—É–ª—è—Ä–Ω—ã–º(–æ–π)",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 2, "–ì–µ–ª–∏–æ–¥–æ—Ä": 1},
            ),
            AnswerOption(
                text="–û —Å–≤–æ—ë–º –¥–µ–ª–µ/–±–∏–∑–Ω–µ—Å–µ, –±—ã—Ç—å —Ö–æ–∑—è–∏–Ω–æ–º —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 2, "–†—É–±–∏–Ω": 1},
            ),
            AnswerOption(
                text="–û —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º, –ª–µ—á–∏—Ç—å, —É—á–∏—Ç—å",
                score_changes={"–°–∞–ø—Ñ–∏—Ä": 2, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
            AnswerOption(
                text="–û –∫—Ä–∞—Å–∏–≤–æ–π –∂–∏–∑–Ω–∏, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö, —ç—Å—Ç–µ—Ç–∏–∫–µ",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2},
            ),
            AnswerOption(
                text="–û —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, –¥–æ–º–µ, —É—é—Ç–µ",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 2},
            ),
        ],
    )

    # Q14 ‚Äì —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ö–∞–æ—Å
    q["b1_q14_chaos"] = Question(
        id="b1_q14_chaos",
        text="–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–æ–º–Ω–∞—Ç—É, –≥–¥–µ –≤—Å—ë —Ä–∞—Å–∫–∏–¥–∞–Ω–æ. –ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
        options=[
            AnswerOption(
                text="–•–æ—Ç–µ–ª–æ—Å—å –≤—Å—ë —Ä–∞–∑–ª–æ–∂–∏—Ç—å –ø–æ –º–µ—Å—Ç–∞–º, —Ç—Ä—É–¥–Ω–æ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è –≤ —Ö–∞–æ—Å–µ",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 2},
            ),
            AnswerOption(
                text="–ú–æ–≥(–ª–∞) –Ω–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫, –Ω–æ –Ω–µ —Å—Ä–∞–∑—É",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–ù–µ –Ω–∞–ø—Ä—è–≥–∞–ª–æ, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ/–≤–µ—Å–µ–ª–æ",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 1, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
        ],
    )

    # Q15 ‚Äì –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è
    q["b1_q15_competition"] = Question(
        id="b1_q15_competition",
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º?",
        options=[
            AnswerOption(
                text="–í–∞–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –ª—É—á—à–∏–º(–µ–π), —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞–ª(–∞), –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ª—É—á—à–µ",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 1, "–®—É–Ω–≥–∏—Ç": 1, "–¶–∏—Ç—Ä–∏–Ω": 1},
            ),
            AnswerOption(
                text="–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º(–æ–π)",
                score_changes={"–®—É–Ω–≥–∏—Ç": 1},
            ),
            AnswerOption(
                text="–ù–µ –ª—é–±–∏–ª(–∞) –¥—É—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π, –∏–∑–±–µ–≥–∞–ª(–∞)",
                score_changes={"–°–∞–ø—Ñ–∏—Ä": 1, "–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
        ],
    )

    # --- –í–µ—Ç–≤–ª–µ–Ω–∏—è-–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è ---

    q["b1_q_animals_detail"] = Question(
        id="b1_q_animals_detail",
        text="–ß—Ç–æ –±—ã–ª–æ —Å–∞–º—ã–º –≤–∞–∂–Ω—ã–º –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –∫ –∂–∏–≤–æ—Ç–Ω—ã–º?",
        options=[
            AnswerOption(
                text="–ß—Ç–æ–±—ã –∏–º –±—ã–ª–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ, —Ç–µ–ø–ª–æ, —á—Ç–æ–±—ã –±—ã–ª–∏ —Å—ã—Ç—ã",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2, "–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–û–±–Ω–∏–º–∞—Ç—å, –∏–≥—Ä–∞—Ç—å, —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –ª—é–±–æ–≤—å –∏ –∫–æ–Ω—Ç–∞–∫—Ç",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2},
            ),
            AnswerOption(
                text="–ù–∞–±–ª—é–¥–∞—Ç—å, –∫–∞–∫ –æ–Ω–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è –∏ –≤–µ–¥—É—Ç —Å–µ–±—è",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 1, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
        ],
    )

    q["b1_q_sport_detail"] = Question(
        id="b1_q_sport_detail",
        text="–ß—Ç–æ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –≤ —Å–ø–æ—Ä—Ç–µ –∏ –¥–≤–∏–∂–µ–Ω–∏–∏?",
        options=[
            AnswerOption(
                text="–ß—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–∏–ª—É —Ç–µ–ª–∞, —É—Å—Ç–∞–ª–æ—Å—Ç—å, –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å —Å–µ–±—è",
                score_changes={"–®—É–Ω–≥–∏—Ç": 2},
            ),
            AnswerOption(
                text="–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –º–µ–¥–∞–ª–∏, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏ –≤–Ω–∏–º–∞–Ω–∏–µ",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 1, "–®—É–Ω–≥–∏—Ç": 1},
            ),
            AnswerOption(
                text="–ö–æ–º–∞–Ω–¥–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è, –æ–±—â–µ–Ω–∏–µ",
                score_changes={"–ì–µ–ª–∏–æ–¥–æ—Ä": 1, "–®—É–Ω–≥–∏—Ç": 1},
            ),
        ],
    )

    q["b1_q_stage_detail"] = Question(
        id="b1_q_stage_detail",
        text="–ß—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–∏—Ç—è–≥–∏–≤–∞–ª–æ –≤ —Å—Ü–µ–Ω–µ –∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è—Ö?",
        options=[
            AnswerOption(
                text="–ë—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è, –≤–∏–¥–µ—Ç—å —Ä–µ–∞–∫—Ü–∏—é –ª—é–¥–µ–π",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 2, "–ì–µ–ª–∏–æ–¥–æ—Ä": 1},
            ),
            AnswerOption(
                text="–ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –æ–±—Ä–∞–∑, —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–∞–∫ –≤—Å—ë –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å",
                score_changes={"–†—É–±–∏–Ω": 2, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
            AnswerOption(
                text="–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≥–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–∏ –∏ —Å–º—ã—Å–ª—ã —á–µ—Ä–µ–∑ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 1, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
        ],
    )

    q["b1_q_talk_detail"] = Question(
        id="b1_q_talk_detail",
        text="–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –æ–±—â–µ–Ω–∏—è —Ç–µ–±–µ –±—ã–ª –±–ª–∏–∂–µ?",
        options=[
            AnswerOption(
                text="–†–∞–∑–≤–ª–µ–∫–∞—Ç—å, —à—É—Ç–∏—Ç—å, –ø–æ–¥–Ω–∏–º–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
                score_changes={"–ì–µ–ª–∏–æ–¥–æ—Ä": 2, "–ì—Ä–∞–Ω–∞—Ç": 1},
            ),
            AnswerOption(
                text="–ì–ª—É–±–æ–∫–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –ø–æ –¥—É—à–∞–º –æ–¥–∏–Ω –Ω–∞ –æ–¥–∏–Ω",
                score_changes={"–°–∞–ø—Ñ–∏—Ä": 1, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
            AnswerOption(
                text="–û–±—Å—É–∂–¥–∞—Ç—å –∏–¥–µ–∏, –ø–ª–∞–Ω—ã, –∫–∞–∫ —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å –∏–ª–∏ —É–ª—É—á—à–∏—Ç—å",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 1, "–†—É–±–∏–Ω": 1, "–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
        ],
    )

    q["b1_q_reading_detail"] = Question(
        id="b1_q_reading_detail",
        text="–ö–∞–∫–∏–µ –∫–Ω–∏–≥–∏/–º–∞—Ç–µ—Ä–∏–∞–ª—ã –±—ã–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ –≤—Å–µ–≥–æ?",
        options=[
            AnswerOption(
                text="–ù–∞—É—á–ø–æ–ø, —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –º–∏—Ä",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 2, "–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–ò—Å—Ç–æ—Ä–∏–∏ –ª—é–¥–µ–π, —Å—É–¥—å–±—ã, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è",
                score_changes={"–°–∞–ø—Ñ–∏—Ä": 2, "–ò–∑—É–º—Ä—É–¥": 1},
            ),
            AnswerOption(
                text="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –º–∞–≥–∏—è, –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è",
                score_changes={"–ì—Ä–∞–Ω–∞—Ç": 1, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
            AnswerOption(
                text="–ü—Ä–∞–∫—Ç–∏–∫–∞: –¥–µ–Ω—å–≥–∏, –±–∏–∑–Ω–µ—Å, —É—Å–ø–µ—Ö",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 2},
            ),
        ],
    )

    q["b1_q_trading_detail"] = Question(
        id="b1_q_trading_detail",
        text="–ß—Ç–æ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –≤ –∏–≥—Ä–∞—Ö ¬´–º–∞–≥–∞–∑–∏–Ω¬ª, –æ–±–º–µ–Ω–∞—Ö, –ø—Ä–æ–¥–∞–∂–∞—Ö?",
        options=[
            AnswerOption(
                text="–°–∞–º –ø—Ä–æ—Ü–µ—Å—Å —Å–¥–µ–ª–∫–∏: –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, —É–≥–æ–≤–æ—Ä–∏—Ç—å, –ø—Ä–æ–¥–∞—Ç—å –¥–æ—Ä–æ–∂–µ",
                score_changes={"–¶–∏—Ç—Ä–∏–Ω": 2, "–ì–µ–ª–∏–æ–¥–æ—Ä": 1},
            ),
            AnswerOption(
                text="–ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –≤–∏—Ç—Ä–∏–Ω—É, —É–ø–∞–∫–æ–≤—ã–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 2, "–†—É–±–∏–Ω": 1},
            ),
            AnswerOption(
                text="–°—á–∏—Ç–∞—Ç—å, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –∫—Ç–æ —Å–∫–æ–ª—å–∫–æ –¥–æ–ª–∂–µ–Ω, –≤–µ—Å—Ç–∏ —É—Å–ª–æ–≤–Ω—É—é ¬´–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é¬ª",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 2, "–ê–º–µ—Ç–∏—Å—Ç": 1},
            ),
        ],
    )

    q["b1_q_order_tech_detail"] = Question(
        id="b1_q_order_tech_detail",
        text="–ß—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –≤ –ø–æ—Ä—è–¥–∫–µ/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö?",
        options=[
            AnswerOption(
                text="–ö–æ–≥–¥–∞ –≤—Å—ë —Ä–∞–∑–ª–æ–∂–µ–Ω–æ –ø–æ –ø–æ–ª–æ—á–∫–∞–º, —á–∏—Å—Ç–æ –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ",
                score_changes={"–Ø–Ω—Ç–∞—Ä—å": 2},
            ),
            AnswerOption(
                text="–°–æ–±–∏—Ä–∞—Ç—å/—Ä–∞–∑–±–∏—Ä–∞—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏",
                score_changes={"–ê–º–µ—Ç–∏—Å—Ç": 1, "–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
            AnswerOption(
                text="–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –∏ —É–¥–æ–±–Ω–æ, –∏ –∫—Ä–∞—Å–∏–≤–æ",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 1, "–Ø–Ω—Ç–∞—Ä—å": 1},
            ),
        ],
    )

    q["b1_q_music_detail"] = Question(
        id="b1_q_music_detail",
        text="–ö–∞–∫—É—é —Ä–æ–ª—å –∏–≥—Ä–∞–ª–∞ –º—É–∑—ã–∫–∞/–ø–µ–Ω–∏–µ?",
        options=[
            AnswerOption(
                text="–õ—é–±–∏–ª(–∞) –ø–µ—Ç—å —Å–∞–º(–∞), —Ö–æ—Ç–µ–ª–æ—Å—å –≤—ã—Å—Ç—É–ø–∞—Ç—å",
                score_changes={"–ì–µ–ª–∏–æ–¥–æ—Ä": 2, "–ì—Ä–∞–Ω–∞—Ç": 1},
            ),
            AnswerOption(
                text="–ë–æ–ª—å—à–µ —Å–ª—É—à–∞—Ç—å –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –º—É–∑—ã–∫—É, —á–µ–º –≤—ã—Å—Ç—É–ø–∞—Ç—å",
                score_changes={"–ò–∑—É–º—Ä—É–¥": 1, "–°–∞–ø—Ñ–∏—Ä": 1},
            ),
            AnswerOption(
                text="–ú—É–∑—ã–∫–∞ –±—ã–ª–∞ —Ñ–æ–Ω–æ–º, –æ—Å–æ–±–æ–π —Ä–æ–ª–∏ –Ω–µ –∏–≥—Ä–∞–ª–∞",
                score_changes={},
            ),
        ],
    )

    return q


CORE_SEQUENCE_BLOCK1 = [
    "b1_q1_free_time",
    "b1_q2_subjects",
    "b1_q3_clubs",
    "b1_q4_choice",
    "b1_q5_speaking",
    "b1_q6_animals",
    "b1_q7_body",
    "b1_q8_order",
    "b1_q9_reading",
    "b1_q10_money",
    "b1_q11_scene",
    "b1_q12_empathy",
    "b1_q13_dreams",
    "b1_q14_chaos",
    "b1_q15_competition",
]


def init_block1_state():
    if st.session_state.get("b1_initialized", False):
        return

    st.session_state.b1_initialized = True
    st.session_state.b1_questions = build_block1_questions()
    st.session_state.b1_scores = {p: 0 for p in POTENTIALS}
    st.session_state.b1_answers: Dict[str, int] = {}
    st.session_state.b1_current_qid: Optional[str] = CORE_SEQUENCE_BLOCK1[0]
    st.session_state.b1_core_index: int = 0
    st.session_state.b1_injected_queue: List[str] = []
    st.session_state.b1_finished: bool = False
    st.session_state.setdefault("block1_text", "")


def b1_get_next_qid() -> Optional[str]:
    # —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ç–∫–∏
    while st.session_state.b1_injected_queue:
        next_id = st.session_state.b1_injected_queue.pop(0)
        if next_id not in st.session_state.b1_answers:
            return next_id

    # –ø–æ—Ç–æ–º –±–∞–∑–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    while True:
        st.session_state.b1_core_index += 1
        if st.session_state.b1_core_index >= len(CORE_SEQUENCE_BLOCK1):
            return None
        candidate = CORE_SEQUENCE_BLOCK1[st.session_state.b1_core_index]
        if candidate not in st.session_state.b1_answers:
            return candidate


def b1_apply_answer(question: Question, option_index: int):
    st.session_state.b1_answers[question.id] = option_index
    option = question.options[option_index]

    # –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–ª—ã
    for pot, delta in option.score_changes.items():
        if pot in st.session_state.b1_scores:
            st.session_state.b1_scores[pot] += delta

    # –¥–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ç–∫–∏
    for qid in option.inject_questions:
        if (
            qid not in st.session_state.b1_answers
            and qid not in st.session_state.b1_injected_queue
        ):
            st.session_state.b1_injected_queue.append(qid)

    next_id = b1_get_next_qid()
    st.session_state.b1_current_qid = next_id
    if next_id is None:
        st.session_state.b1_finished = True


def b1_render_question(question: Question):
    st.subheader("–ë–ª–æ–∫ 1 ¬∑ –î–µ—Ç—Å—Ç–≤–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç–∏")

    answered = len(st.session_state.b1_answers)
    approx_total = len(CORE_SEQUENCE_BLOCK1) + 8
    progress = min(1.0, answered / approx_total)
    st.progress(progress)

    st.markdown(f"**–í–æ–ø—Ä–æ—Å:** {question.text}")

    options = question.options
    option_key = f"b1_q_{question.id}"
    default_index = st.session_state.b1_answers.get(question.id, 0)

    choice_index = st.radio(
        "–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç:",
        options=list(range(len(options))),
        format_func=lambda i: options[i].text,
        index=default_index if question.id in st.session_state.b1_answers else 0,
        key=option_key,
    )

    if st.button("–î–∞–ª—å—à–µ", key=f"b1_next_{question.id}"):
        b1_apply_answer(question, choice_index)


def b1_render_finish():
    st.subheader("–ë–ª–æ–∫ 1 –∑–∞–≤–µ—Ä—à—ë–Ω ‚úÖ")

    st.markdown(
        "–î–∞–ª—å—à–µ –º—ã –ø–æ–π–¥—ë–º –≤ –±–ª–æ–∫–∏ –ø—Ä–æ —Ä–∞–±–æ—Ç—É –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ. "
        "–§–∏–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ç—Ä—ë—Ö –±–ª–æ–∫–æ–≤."
    )

    st.session_state.block1_text = st.text_area(
        "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –¥–æ–±–∞–≤—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: —á–µ–º —Ç—ã –∂–∏–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ, —á—Ç–æ —Ç–æ—á–Ω–æ –±—ã–ª–æ ¬´—Ç–≤–æ–∏–º¬ª?",
        value=st.session_state.block1_text,
        height=150,
        key="b1_free_text",
    )

    if st.button("‚úîÔ∏è –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ë–ª–æ–∫ 1 –∏ –ø–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ"):
        # –ü–µ—Ä–µ–Ω–æ—Å–∏–º –±–∞–ª–ª—ã –≤ block1_cols ‚Äî –∫–ª–∞–¥—ë–º –≤ –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –∫–∞–∫ ¬´–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—É—é –±–∞–∑—É¬ª
        cols = {p: {c: 0 for c in COLUMNS} for p in POTENTIALS}
        scores = st.session_state.b1_scores
        for pot in POTENTIALS:
            cols[pot]["c1"] = scores.get(pot, 0)

        st.session_state.block1_cols = cols
        st.success("–ë–ª–æ–∫ 1 —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ú–æ–∂–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –≤ –ë–ª–æ–∫ 2.")


def run_block1():
    st.header("–ë–ª–æ–∫ 1. –î–µ—Ç—Å—Ç–≤–æ, —Ä–∞–Ω–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –±–∞–∑–æ–≤—ã–µ –Ω–∞–º—ë–∫–∏")

    init_block1_state()

    if not st.session_state.b1_finished and st.session_state.b1_current_qid:
        qid = st.session_state.b1_current_qid
        question = st.session_state.b1_questions[qid]
        b1_render_question(question)
    else:
        b1_render_finish()


# =====================================================
# –ë–õ–û–ö 2. –†–ê–ë–û–¢–ê, –ü–†–û–§–ï–°–°–ò–ò, –ü–†–û–¶–ï–°–°–´ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≥–∏–±—Ä–∏–¥)
# =====================================================

def run_block2():
    st.header("–ë–ª–æ–∫ 2. –†–∞–±–æ—Ç–∞, –ø—Ä–æ—Ü–µ—Å—Å—ã, –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏")

    st.markdown(
        "–ó–¥–µ—Å—å ‚Äî –ø—Ä–æ —Ç–æ, —á–µ–º —Ç—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è —Å–µ–π—á–∞—Å, –∏ —á—Ç–æ –¥–∞—ë—Ç/–∑–∞–±–∏—Ä–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é."
    )

    st.subheader("–¢–≤–æ–π —Ç–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã")

    role = st.selectbox(
        "–ë–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ —Ç–≤–æ–µ–π —Ç–µ–∫—É—â–µ–π —Ä–æ–ª–∏:",
        [
            "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç / —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä",
            "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å / —Ç–∏–º–ª–∏–¥",
            "–¢–≤–æ—Ä–µ—Ü-–∫—Ä–µ–∞—Ç–æ—Ä / –±–ª–æ–≥–µ—Ä",
            "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å / –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞",
            "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏ (L&D, HR, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –¥—Ä.)",
            "–î—Ä—É–≥–æ–µ",
        ],
    )

    liked_proc = st.multiselect(
        "–ö–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø—Ä–∏–Ω–æ—Å—è—Ç —Ç–µ–±–µ —ç–Ω–µ—Ä–≥–∏—é –∏ —á—É–≤—Å—Ç–≤–æ ¬´—è –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ¬ª?",
        [
            "–ì–ª—É–±–æ–∫–æ –¥—É–º–∞—Ç—å, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —Å–æ–±–∏—Ä–∞—Ç—å –ø–∞–∑–ª",
            "–†–µ—á—å, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è, –æ–±—â–µ–Ω–∏–µ —Å –ª—é–¥—å–º–∏",
            "–°–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–æ—Ç—É (–≤–∏–∑—É–∞–ª, —Ç–µ–∫—Å—Ç, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ, –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞)",
            "–°—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É, –ø—Ä–æ—Ü–µ—Å—Å—ã, –Ω–∞–≤–æ–¥–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫",
            "–ü—Ä–æ–¥–∞–≤–∞—Ç—å, –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å—Å—è, –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏",
            "–ó–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã, —Å–æ–±–∏—Ä–∞—Ç—å –ª—é–¥–µ–π, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –¥–≤–∏–∂—É—Ö—É",
            "–†–∞–±–æ—Ç–∞—Ç—å —Ç–µ–ª–æ–º (—Å–ø–æ—Ä—Ç, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –º–∞—Å—Å–∞–∂ –∏ —Ç.–ø.)",
        ],
    )

    drained_proc = st.multiselect(
        "–ß—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∑–∞–±–∏—Ä–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é (–µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ–ª–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ)?",
        [
            "–ú–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è, –∑–≤–æ–Ω–∫–æ–≤, –≤—Å—Ç—Ä–µ—á",
            "–†—É—Ç–∏–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –æ—Ç—á—ë—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—Ç–∞–ª–µ–π",
            "–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–∞ –ø—É–±–ª–∏–∫—É –∏ —Å—Ü–µ–Ω–∞",
            "–ü—Ä–æ–¥–∞–∂–∏ –∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã",
            "–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã",
            "–°—Ç—Ä–µ—Å—Å–æ–≤—ã–µ –¥–µ–¥–ª–∞–π–Ω—ã, –ø–æ–∂–∞—Ä–æ—Ç—É—à–µ–Ω–∏–µ",
            "–§–∏–∑–∏—á–µ—Å–∫–∏–π —Ç—Ä—É–¥, –¥–ª–∏–Ω–Ω—ã–µ —Å–º–µ–Ω—ã –Ω–∞ –Ω–æ–≥–∞—Ö",
        ],
    )

    cols = {p: {c: 0 for c in COLUMNS} for p in POTENTIALS}

    # –ø—Ä–æ—Ü–µ—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø–æ–ª–Ω—è—é—Ç
    for p in liked_proc:
        if p.startswith("–ì–ª—É–±–æ–∫–æ –¥—É–º–∞—Ç—å"):
            cols["–ê–º–µ—Ç–∏—Å—Ç"]["c2"] += 2
            cols["–°–∞–ø—Ñ–∏—Ä"]["c1"] += 1
        if p.startswith("–†–µ—á—å, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è"):
            cols["–ì–µ–ª–∏–æ–¥–æ—Ä"]["c2"] += 2
            cols["–ì—Ä–∞–Ω–∞—Ç"]["c3"] += 1
        if p.startswith("–°–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–æ—Ç—É"):
            cols["–ò–∑—É–º—Ä—É–¥"]["c2"] += 2
        if p.startswith("–°—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É"):
            cols["–Ø–Ω—Ç–∞—Ä—å"]["c2"] += 2
            cols["–ê–º–µ—Ç–∏—Å—Ç"]["c1"] += 1
        if p.startswith("–ü—Ä–æ–¥–∞–≤–∞—Ç—å"):
            cols["–¶–∏—Ç—Ä–∏–Ω"]["c3"] += 2
            cols["–ì–µ–ª–∏–æ–¥–æ—Ä"]["c2"] += 1
        if p.startswith("–ó–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã"):
            cols["–†—É–±–∏–Ω"]["c3"] += 2
            cols["–¶–∏—Ç—Ä–∏–Ω"]["c2"] += 1
        if p.startswith("–†–∞–±–æ—Ç–∞—Ç—å —Ç–µ–ª–æ–º"):
            cols["–®—É–Ω–≥–∏—Ç"]["c2"] += 2

    # –ø—Ä–æ—Ü–µ—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–º–∞—Ç—ã–≤–∞—é—Ç
    for p in drained_proc:
        if p.startswith("–ú–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è"):
            cols["–ì–µ–ª–∏–æ–¥–æ—Ä"]["c2"] -= 1
        if p.startswith("–†—É—Ç–∏–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã"):
            cols["–Ø–Ω—Ç–∞—Ä—å"]["c2"] -= 1
        if p.startswith("–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–∞ –ø—É–±–ª–∏–∫—É"):
            cols["–ì—Ä–∞–Ω–∞—Ç"]["c3"] -= 1
        if p.startswith("–ü—Ä–æ–¥–∞–∂–∏"):
            cols["–¶–∏—Ç—Ä–∏–Ω"]["c3"] -= 1
        if p.startswith("–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"):
            cols["–ò–∑—É–º—Ä—É–¥"]["c2"] -= 1
        if p.startswith("–§–∏–∑–∏—á–µ—Å–∫–∏–π —Ç—Ä—É–¥"):
            cols["–®—É–Ω–≥–∏—Ç"]["c2"] -= 1

    st.markdown("---")
    st.subheader("–°–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç")

    t1 = st.text_area(
        "–û–ø–∏—à–∏ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —á–µ–º —Ç—ã —Å–µ–π—á–∞—Å –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è –∏ –≥–¥–µ —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–±—è –∂–∏–≤—ã–º(–æ–π).",
        height=160,
        key="b2_text_main",
    )

    t2 = st.text_area(
        "–ï—Å–ª–∏ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ —Å–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞ ‚Äî —á—Ç–æ –±—ã —Ç—ã –≤—ã–±—Ä–∞–ª(–∞)? –ü–æ—á–µ–º—É?",
        height=160,
        key="b2_text_alt",
    )

    if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ë–ª–æ–∫ 2"):
        st.session_state.block2_cols = cols
        full_text = ""
        for x in (t1, t2):
            if x.strip():
                full_text += x.strip() + "\n\n"
        st.session_state.block2_text = full_text.strip()
        st.success("–ë–ª–æ–∫ 2 —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ú–æ–∂–Ω–æ –∏–¥—Ç–∏ –∫ –ë–ª–æ–∫—É 3.")


# =====================================================
# –ë–õ–û–ö 3. –û–ö–†–£–ñ–ï–ù–ò–ï, –ì–ï–†–û–ò, –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–´–ï –ú–ò–†–´
# =====================================================

def run_block3():
    st.header("–ë–ª–æ–∫ 3. –û–∫—Ä—É–∂–µ–Ω–∏–µ, –ª—é–¥–∏, –≥–µ—Ä–æ–∏, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –º–∏—Ä—ã")

    fav_people = st.multiselect(
        "–° –∫–µ–º —Ç–µ–±–µ –æ—Å–æ–±–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –æ–±—â–∞—Ç—å—Å—è / –¥—Ä—É–∂–∏—Ç—å?",
        [
            "–ì–ª—É–±–æ–∫–∏–µ, —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ, —á—É—Ç—å —á—É–¥–∞–∫–æ–≤–∞—Ç—ã–µ –º—ã—Å–ª–∏—Ç–µ–ª–∏",
            "–¢–µ, –∫—Ç–æ –¥–µ–ª–∞–µ—Ç –¥–≤–∏–∂—É—Ö—É, —Ç—É—Å–æ–≤–∫–∏, –∏–≤–µ–Ω—Ç—ã",
            "–û—á–µ–Ω—å —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–µ, —Å–º–µ—à–Ω—ã–µ, –ª—ë–≥–∫–∏–µ –ª—é–¥–∏",
            "–ö—Ä–∞—Å–∏–≤—ã–µ, —ç—Å—Ç–µ—Ç–∏—á–Ω—ã–µ –ª—é–¥–∏ —Å –≤–∫—É—Å–æ–º –∏ —Å—Ç–∏–ª–µ–º",
            "–°—É–ø–µ—Ä—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ, —Å–∏—Å—Ç–µ–º–Ω—ã–µ, –Ω–∞–¥—ë–∂–Ω—ã–µ",
            "–ë–∏–∑–Ω–µ—Å–º–µ–Ω—ã, –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏, –ª—é–¥–∏ —Å –¥–µ–Ω—å–≥–∞–º–∏",
            "–°–ø–æ—Ä—Ç—Å–º–µ–Ω—ã, —Ç—Ä–µ–Ω–µ—Ä—ã, —Ç–µ –∫—Ç–æ –≤ —Ç–µ–ª–µ –∏ —Å–∏–ª–µ",
        ],
    )

    fav_worlds = st.multiselect(
        "–ö–∞–∫–∏–µ –≤—Å–µ–ª–µ–Ω–Ω—ã–µ / —Ñ–∏–ª—å–º—ã / –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ–±—è —Ç—è–Ω—É—Ç?",
        [
            "–ü—Ä–æ –º–∞–≥–∏—é, –º–∏—Å—Ç–∏–∫—É, –¥—Ä—É–≥–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è",
            "–ü—Ä–æ —Å–ø–æ—Ä—Ç, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ, –ø–æ–±–µ–¥—ã",
            "–ü—Ä–æ –±–∏–∑–Ω–µ—Å, –¥–µ–Ω—å–≥–∏, –±–æ–ª—å—à–∏–µ –∏–≥—Ä—ã",
            "–ü—Ä–æ –∫—Ä–∞—Å–æ—Ç—É, –∏—Å–∫—É—Å—Å—Ç–≤–æ, –º–æ–¥—É, –¥–∏–∑–∞–π–Ω",
            "–ü—Ä–æ –ø–æ–ª–∏—Ç–∏–∫—É, –≤–ª–∏—è–Ω–∏–µ, –±–æ–ª—å—à–∏–µ —Å–º—ã—Å–ª—ã",
            "–ü—Ä–æ –≤—ã–∂–∏–≤–∞–Ω–∏–µ, —Å–∏–ª—É, –±–æ—Ä—å–±—É",
        ],
    )

    cols = {p: {c: 0 for c in COLUMNS} for p in POTENTIALS}

    # –õ—é–¥–∏
    for p in fav_people:
        if p.startswith("–ì–ª—É–±–æ–∫–∏–µ"):
            cols["–°–∞–ø—Ñ–∏—Ä"]["c1"] += 2
            cols["–ê–º–µ—Ç–∏—Å—Ç"]["c1"] += 1
        if p.startswith("–¢–µ, –∫—Ç–æ –¥–µ–ª–∞–µ—Ç –¥–≤–∏–∂—É—Ö—É"):
            cols["–†—É–±–∏–Ω"]["c2"] += 2
            cols["–ì—Ä–∞–Ω–∞—Ç"]["c3"] += 1
        if p.startswith("–û—á–µ–Ω—å —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–µ"):
            cols["–ì–µ–ª–∏–æ–¥–æ—Ä"]["c2"] += 2
            cols["–ì—Ä–∞–Ω–∞—Ç"]["c3"] += 1
        if p.startswith("–ö—Ä–∞—Å–∏–≤—ã–µ, —ç—Å—Ç–µ—Ç–∏—á–Ω—ã–µ"):
            cols["–ò–∑—É–º—Ä—É–¥"]["c2"] += 2
        if p.startswith("–°—É–ø–µ—Ä—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ"):
            cols["–Ø–Ω—Ç–∞—Ä—å"]["c1"] += 1
            cols["–Ø–Ω—Ç–∞—Ä—å"]["c2"] += 1
        if p.startswith("–ë–∏–∑–Ω–µ—Å–º–µ–Ω—ã"):
            cols["–¶–∏—Ç—Ä–∏–Ω"]["c3"] += 2
        if p.startswith("–°–ø–æ—Ä—Ç—Å–º–µ–Ω—ã"):
            cols["–®—É–Ω–≥–∏—Ç"]["c3"] += 2

    # –ú–∏—Ä—ã
    for w in fav_worlds:
        if w.startswith("–ü—Ä–æ –º–∞–≥–∏—é"):
            cols["–°–∞–ø—Ñ–∏—Ä"]["c1"] += 1
            cols["–ê–º–µ—Ç–∏—Å—Ç"]["c1"] += 1
        if w.startswith("–ü—Ä–æ —Å–ø–æ—Ä—Ç"):
            cols["–®—É–Ω–≥–∏—Ç"]["c3"] += 1
        if w.startswith("–ü—Ä–æ –±–∏–∑–Ω–µ—Å"):
            cols["–¶–∏—Ç—Ä–∏–Ω"]["c3"] += 1
        if w.startswith("–ü—Ä–æ –∫—Ä–∞—Å–æ—Ç—É"):
            cols["–ò–∑—É–º—Ä—É–¥"]["c2"] += 1
        if w.startswith("–ü—Ä–æ –ø–æ–ª–∏—Ç–∏–∫—É"):
            cols["–ê–º–µ—Ç–∏—Å—Ç"]["c1"] += 1
            cols["–†—É–±–∏–Ω"]["c3"] += 1
        if w.startswith("–ü—Ä–æ –≤—ã–∂–∏–≤–∞–Ω–∏–µ"):
            cols["–®—É–Ω–≥–∏—Ç"]["c3"] += 1

    st.markdown("---")
    st.subheader("–°–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç")

    t1 = st.text_area(
        "–û–ø–∏—à–∏ 2‚Äì3 –≥–µ—Ä–æ—è (–∏–∑ —Ñ–∏–ª—å–º–æ–≤, –∫–Ω–∏–≥, —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏), –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±—è —Å–∏–ª—å–Ω–æ —Ü–µ–ø–ª—è—é—Ç. –ß—Ç–æ –≤ –Ω–∏—Ö —Ç–∞–∫–æ–≥–æ?",
        height=200,
        key="b3_text_heroes",
    )
    t2 = st.text_area(
        "–ï—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å ¬´–∏–¥–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –º–∏—Ä¬ª, –≥–¥–µ —É —Ç–µ–±—è –º–∞–∫—Å–∏–º—É–º —Å–≤–æ–±–æ–¥—ã ‚Äî –∫–∞–∫ —Ç—ã —Ç–∞–º –∂–∏–≤—ë—à—å –∏ –ø—Ä–æ—è–≤–ª—è–µ—à—å—Å—è?",
        height=200,
        key="b3_text_world",
    )

    if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ë–ª–æ–∫ 3"):
        st.session_state.block3_cols = cols
        full_text = ""
        for x in (t1, t2):
            if x.strip():
                full_text += x.strip() + "\n\n"
        st.session_state.block3_text = full_text.strip()
        st.success("–ë–ª–æ–∫ 3 —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–Ω–∞–ª—É.")


# =====================================================
# –ê–ì–†–ï–ì–ê–¢–û–† (–±–µ–∑ –æ—Ç—á—ë—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞)
# =====================================================

def aggregate_all_blocks() -> Dict[str, Dict[str, int]]:
    combined = {p: {c: 0 for c in COLUMNS} for p in POTENTIALS}
    for block in (1, 2, 3):
        cols_key = f"block{block}_cols"
        cols = st.session_state.get(cols_key, {})
        if not cols:
            continue
        for p in POTENTIALS:
            for c in COLUMNS:
                combined[p][c] += cols.get(p, {}).get(c, 0)
    return combined


def client_finish_page():
    st.header("–§–∏–Ω–∞–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏")

    st.markdown(
        "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø—Ä–æ—à—ë–ª(–∞) –≤—Å–µ –±–ª–æ–∫–∏. –ù–∏–∂–µ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π, —á—Ç–æ–±—ã —è –º–æ–≥–ª–∞ —Å —Ç–æ–±–æ–π —Å–≤—è–∑–∞—Ç—å—Å—è."
    )

    name = st.text_input("–ö–∞–∫ –∫ —Ç–µ–±–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è?", value=st.session_state.get("user_name", ""))
    contact = st.text_input("–ö–æ–Ω—Ç–∞–∫—Ç (Telegram, e-mail –∏ —Ç.–ø.)", value=st.session_state.get("user_contact", ""))

    st.session_state.user_name = name
    st.session_state.user_contact = contact

    st.info(
        "–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —Ç—ã –Ω–µ –≤–∏–¥–∏—à—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É ‚Äî –µ—ë —Å–æ–±–∏—Ä–∞–µ—Ç –º–∞—Å—Ç–µ—Ä –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ç–µ–±–µ —É–∂–µ –≤ –≤–∏–¥–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –æ—Ç—á—ë—Ç–∞."
    )

    if st.button("‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–∞—Å—Ç–µ—Ä—É"):
        combined = aggregate_all_blocks()

        # —Å–æ–±—Ä–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç
        text_parts = []
        for block in (1, 2, 3):
            key = f"block{block}_text"
            txt = st.session_state.get(key, "")
            if txt:
                text_parts.append(f"=== –ë–ª–æ–∫ {block} ===\n{txt}")
        full_text = "\n\n".join(text_parts).strip()

        results = load_results()
        new_entry = {
            "timestamp": datetime.now().isoformat(timespec="seconds"),
            "name": name,
            "contact": contact,
            "combined": combined,
            "text": full_text,
        }
        results.append(new_entry)
        save_results(results)

        st.success(
            "–ì–æ—Ç–æ–≤–æ üíõ –¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –º–∞—Å—Ç–µ—Ä—É. "
            "–ü–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ —Ç—ã –ø–æ–ª—É—á–∏—à—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç."
        )


# =====================================================
# MAIN
# =====================================================

def main():
    st.set_page_config(
        page_title="Deep Identity ¬∑ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤",
        layout="wide",
    )

    init_session_state()

    st.title("Deep Identity ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤")

    page = st.sidebar.radio(
        "–ù–∞–≤–∏–≥–∞—Ü–∏—è",
        ["–ë–ª–æ–∫ 1", "–ë–ª–æ–∫ 2", "–ë–ª–æ–∫ 3", "–§–∏–Ω–∞–ª"],
    )

    if page == "–ë–ª–æ–∫ 1":
        run_block1()
    elif page == "–ë–ª–æ–∫ 2":
        run_block2()
    elif page == "–ë–ª–æ–∫ 3":
        run_block3()
    else:
        client_finish_page()


if __name__ == "__main__":
    main()
